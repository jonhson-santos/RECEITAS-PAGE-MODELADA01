<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farmácia Natural em Casa | Remédios Naturais Para Toda Família</title>
    <meta name="description" content="Descubra como tratar naturalmente diabetes, insônia, ansiedade e mais com ingredientes da sua cozinha. Guia completo de receitas naturais." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script>
      // ALTERE O LINK PARA A PÁGINA QUE QUISER MOSTRAR QUANDO O USUÁRIO TENTAR SAIR
      const link = 'https://remarketing-orcin.vercel.app/';

      function setBackRedirect(url) {
        let urlBackRedirect = url;
        urlBackRedirect = urlBackRedirect =
          urlBackRedirect.trim() +
          (urlBackRedirect.indexOf('?') > 0 ? '&' : '?') +
          document.location.search.replace('?', '').toString();

        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);

        window.addEventListener('popstate', () => {
          console.log('onpopstate', urlBackRedirect);
          setTimeout(() => {
            location.href = urlBackRedirect;
          }, 1);
        });
      }

      setBackRedirect(link);
    </script>
    <script>
      // UTMify Pixel - Lógica simplificada e consolidada
      (function() {
        'use strict';
        
        // Verificação única e clara no início - previne carregamento em desenvolvimento
        const isDevelopment = window.location.hostname === 'localhost' || 
                             window.location.hostname === '127.0.0.1' ||
                             window.location.port === '5173';
        
        if (isDevelopment) {
          // Mock do pixel para desenvolvimento
          window.utmify = {
            pixel: {
              track: function(eventName, data) {
                console.log('UTMify Mock:', eventName, data);
              }
            }
          };
          
          // Impedir carregamento do script externo
          return;
        } else {
          // Código UTMify apenas para produção
          window.pixelId = "68ba7e479f0bdf71d9364f2d";
          
          // Função para normalizar URL
          function normalizeUrl() {
            const url = window.location.href;
            const baseUrl = url.split('?')[0];
            const pathParts = baseUrl.split('/');
            
            if (pathParts.length > 3) {
              const lastPart = pathParts[pathParts.length - 1];
              if (lastPart.length < 10 && /^[a-zA-Z0-9]+$/.test(lastPart) && lastPart !== 'index') {
                pathParts.pop();
              }
            }
            
            return pathParts.join('/');
          }
          
          window.normalizedUrl = normalizeUrl();
          
          // Carregar script do pixel apenas uma vez
          if (!document.querySelector('script[src*="utmify"]')) {
            const script = document.createElement("script");
            script.async = true;
            script.defer = true;
            script.src = "https://cdn.utmify.com.br/scripts/pixel/pixel.js";
            script.onerror = function() {
              console.warn('UTMify: Falha ao carregar pixel');
            };
            document.head.appendChild(script);
          }
          
          // Rastrear PageView quando carregado
          window.addEventListener('load', function() {
            setTimeout(function() {
              if (window.utmify && window.utmify.pixel) {
                try {
                  window.utmify.pixel.track('PageView', {
                    url: window.normalizedUrl,
                    title: document.title,
                    referrer: document.referrer,
                    timestamp: new Date().toISOString()
                  });
                } catch (error) {
                  console.warn('UTMify: Erro no PageView', error);
                }
              }
            }, 1000);
          });
          
          // Rastrear cliques com proteção contra erros
          document.addEventListener('click', function(e) {
            try {
              const target = e.target.closest('a, button');
              if (!target) return;
              
              const text = target.textContent.trim();
              const href = target.href || '';
              
              if (text.includes('Quero') || text.includes('Garantir') || text.includes('Acesso') || 
                  text.includes('Liberar') || text.includes('Pagar') || href.includes('pay.kiwify') || 
                  href.includes('pushinpay') || href.includes('remarketing')) {
                
                if (window.utmify && window.utmify.pixel) {
                  window.utmify.pixel.track('ClickButton', {
                    buttonText: text,
                    buttonUrl: href,
                    pageUrl: window.normalizedUrl,
                    timestamp: new Date().toISOString()
                  });
                }
              }
            } catch (error) {
              console.warn('UTMify: Erro no rastreamento de clique', error);
            }
          });
        }
        
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>