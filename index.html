<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farmácia Natural em Casa | Remédios Naturais Para Toda Família</title>
    <meta name="description" content="Descubra como tratar naturalmente diabetes, insônia, ansiedade e mais com ingredientes da sua cozinha. Guia completo de receitas naturais." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script>
      // ALTERE O LINK PARA A PÁGINA QUE QUISER MOSTRAR QUANDO O USUÁRIO TENTAR SAIR
      const link = 'https://remarketing-orcin.vercel.app/';

      function setBackRedirect(url) {
        let urlBackRedirect = url;
        urlBackRedirect = urlBackRedirect =
          urlBackRedirect.trim() +
          (urlBackRedirect.indexOf('?') > 0 ? '&' : '?') +
          document.location.search.replace('?', '').toString();

        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);

        window.addEventListener('popstate', () => {
          console.log('onpopstate', urlBackRedirect);
          setTimeout(() => {
            location.href = urlBackRedirect;
          }, 1);
        });
      }

      setBackRedirect(link);
    </script>
    <script>
      // UTMify Pixel - Só carrega em produção (não em localhost)
      function isLocalEnvironment() {
        const hostname = window.location.hostname;
        
        // Verificar localhost e 127.0.0.1
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          return true;
        }
        
        // Verificar IPs locais comuns
        const localIPRanges = [
          /^192\.168\.\d{1,3}\.\d{1,3}$/,  // 192.168.x.x
          /^10\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,  // 10.x.x.x
          /^172\.(1[6-9]|2\d|3[01])\.\d{1,3}\.\d{1,3}$/,  // 172.16.x.x - 172.31.x.x
          /^0\.0\.0\.0$/,  // 0.0.0.0
          /^\[::1\]$|^::1$/  // IPv6 localhost
        ];
        
        return localIPRanges.some(range => range.test(hostname));
      }
      
      if (!isLocalEnvironment()) {
        window.pixelId = "68ba7e479f0bdf71d9364f2d";
        
        // Função para normalizar a URL removendo parâmetros aleatórios da Vercel
        function normalizeUrl() {
          const url = window.location.href;
          const baseUrl = url.split('?')[0]; // Remove query parameters
          const pathParts = baseUrl.split('/');
          
          // Remove parâmetros aleatórios da Vercel (geralmente são strings curtas no final)
          if (pathParts.length > 3) {
            const lastPart = pathParts[pathParts.length - 1];
            // Se o último segmento parece ser um parâmetro da Vercel (curto e aleatório)
            if (lastPart.length < 10 && /^[a-zA-Z0-9]+$/.test(lastPart) && lastPart !== 'index') {
              pathParts.pop();
            }
          }
          
          return pathParts.join('/');
        }
        
        // Configurar URL normalizada para o pixel
        window.normalizedUrl = normalizeUrl();
        
        // Carregar o script do pixel
        var a = document.createElement("script");
        a.setAttribute("async", "");
        a.setAttribute("defer", "");
        a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
        document.head.appendChild(a);
        
        // Rastrear eventos importantes quando o pixel estiver carregado
        window.addEventListener('load', function() {
          // Aguardar o pixel carregar
          setTimeout(function() {
            // Rastrear visualização de página com URL normalizada
            if (window.utmify && window.utmify.pixel) {
              window.utmify.pixel.track('PageView', {
                url: window.normalizedUrl,
                title: document.title,
                referrer: document.referrer,
                timestamp: new Date().toISOString()
              });
            }
          }, 1000);
        });
        
        // Rastrear cliques em botões importantes
        document.addEventListener('click', function(e) {
          const target = e.target.closest('a, button');
          if (target) {
            const text = target.textContent.trim();
            const href = target.href || '';
            
            // Rastrear cliques em CTAs importantes
            if (text.includes('Quero') || text.includes('Garantir') || text.includes('Acesso') || 
                text.includes('Liberar') || text.includes('Pagar') || href.includes('pay.kiwify') || 
                href.includes('pushinpay') || href.includes('remarketing')) {
              
              if (window.utmify && window.utmify.pixel) {
                window.utmify.pixel.track('ClickButton', {
                  buttonText: text,
                  buttonUrl: href,
                  pageUrl: window.normalizedUrl,
                  timestamp: new Date().toISOString()
                });
              }
            }
          }
        });
        
        // Rastrear scroll depth
        let maxScrollDepth = 0;
        window.addEventListener('scroll', function() {
          const scrollDepth = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
          
          if (scrollDepth > maxScrollDepth) {
            maxScrollDepth = scrollDepth;
            
            // Rastrear marcos importantes de scroll
            if ([25, 50, 75, 90].includes(scrollDepth)) {
              if (window.utmify && window.utmify.pixel) {
                window.utmify.pixel.track('ScrollDepth', {
                  depth: scrollDepth,
                  pageUrl: window.normalizedUrl,
                  timestamp: new Date().toISOString()
                });
              }
            }
          }
        });
      } else {
        // Em desenvolvimento local, apenas log para debug
        console.log('UTMify pixel não carregado em localhost - apenas em produção');
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>