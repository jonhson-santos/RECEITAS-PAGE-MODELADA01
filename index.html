<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farmácia Natural em Casa | Remédios Naturais Para Toda Família</title>
    <meta name="description" content="Descubra como tratar naturalmente diabetes, insônia, ansiedade e mais com ingredientes da sua cozinha. Guia completo de receitas naturais." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script>
      // ALTERE O LINK PARA A PÁGINA QUE QUISER MOSTRAR QUANDO O USUÁRIO TENTAR SAIR
      const link = 'https://remarketing-orcin.vercel.app/';

      function setBackRedirect(url) {
        let urlBackRedirect = url;
        urlBackRedirect = urlBackRedirect =
          urlBackRedirect.trim() +
          (urlBackRedirect.indexOf('?') > 0 ? '&' : '?') +
          document.location.search.replace('?', '').toString();

        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);
        history.pushState({}, '', location.href);

        window.addEventListener('popstate', () => {
          console.log('onpopstate', urlBackRedirect);
          setTimeout(() => {
            location.href = urlBackRedirect;
          }, 1);
        });
      }

      setBackRedirect(link);
    </script>
    <script>
      // UTMify Pixel - Só carrega em produção (não em localhost)
      if (window.location.hostname !== 'localhost' && window.location.port !== '5173') {
        // PRODUÇÃO - Carregar pixel UTMify
        window.pixelId = "68ba7e479f0bdf71d9364f2d";
        
        // Função para normalizar a URL removendo parâmetros aleatórios da Vercel
        function normalizeUrl() {
          const url = window.location.href;
          const baseUrl = url.split('?')[0];
          const pathParts = baseUrl.split('/');
          
          if (pathParts.length > 3) {
            const lastPart = pathParts[pathParts.length - 1];
            if (lastPart.length < 10 && /^[a-zA-Z0-9]+$/.test(lastPart) && lastPart !== 'index') {
              pathParts.pop();
            }
          }
          
          return pathParts.join('/');
        }
        
        window.normalizedUrl = normalizeUrl();
        
        // Carregar o script do pixel
        var a = document.createElement("script");
        a.setAttribute("async", "");
        a.setAttribute("defer", "");
        a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
        document.head.appendChild(a);
        
        // Rastrear eventos quando carregado
        window.addEventListener('load', function() {
          setTimeout(function() {
            if (window.utmify && window.utmify.pixel) {
              window.utmify.pixel.track('PageView', {
                url: window.normalizedUrl,
                title: document.title,
                referrer: document.referrer,
                timestamp: new Date().toISOString()
              });
            }
          }, 1000);
        });
        
        // Rastrear cliques
        document.addEventListener('click', function(e) {
          const target = e.target.closest('a, button');
          if (target) {
            const text = target.textContent.trim();
            const href = target.href || '';
            
            if (text.includes('Quero') || text.includes('Garantir') || text.includes('Acesso') || 
                text.includes('Liberar') || text.includes('Pagar') || href.includes('pay.kiwify') || 
                href.includes('pushinpay') || href.includes('remarketing')) {
              
              if (window.utmify && window.utmify.pixel) {
                window.utmify.pixel.track('ClickButton', {
                  buttonText: text,
                  buttonUrl: href,
                  pageUrl: window.normalizedUrl,
                  timestamp: new Date().toISOString()
                });
              }
            }
          }
        });
      } else {
        // DESENVOLVIMENTO - Mock completo
        console.log('UTMify pixel não carregado em localhost - apenas em produção');
        
        // Mock do fetch para interceptar todas as chamadas
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          console.log('Development Mock - Fetch intercepted:', args[0]);
          return Promise.resolve({
            ok: true,
            json: () => Promise.resolve({ success: true }),
            text: () => Promise.resolve('OK'),
            blob: () => Promise.resolve(new Blob()),
            arrayBuffer: () => Promise.resolve(new ArrayBuffer(0))
          });
        };
        
        // Mock do objeto utmify
        window.utmify = {
          pixel: {
            track: function(eventName, data) {
              console.log('UTMify Mock - Event:', eventName, data);
            }
          }
        };
      }
      
      // Rastrear scroll depth (funciona tanto em dev quanto prod)
      let maxScrollDepth = 0;
      window.addEventListener('scroll', function() {
        const scrollDepth = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
        
        if (scrollDepth > maxScrollDepth) {
          maxScrollDepth = scrollDepth;
          
          // Rastrear marcos importantes de scroll
          if ([25, 50, 75, 90].includes(scrollDepth)) {
            if (window.utmify && window.utmify.pixel) {
              window.utmify.pixel.track('ScrollDepth', {
                depth: scrollDepth,
                pageUrl: window.normalizedUrl || window.location.href,
                timestamp: new Date().toISOString()
              });
            }
          }
        }
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>